(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{0:function(e,a){},15:function(e,a){},16:function(e,a){},"23ae":function(e,a,t){},"4fc5":function(e,a,t){"use strict";t.r(a);var o=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("div",{staticClass:"q-pa-md q-gutter-sm"},[t("q-breadcrumbs",{scopedSlots:e._u([{key:"separator",fn:function(){return[t("q-icon",{attrs:{size:"1.2em",name:"arrow_forward",color:"purple"}})]},proxy:!0}])},[t("q-breadcrumbs-el",{attrs:{label:"Database",icon:"fas fa-database"}}),t("q-breadcrumbs-el",{attrs:{label:"Tables",icon:"fas fa-table"}}),t("q-breadcrumbs-el",{attrs:{label:e.$route.params.tableName}})],1)],1),t("q-separator"),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("q-btn",{attrs:{color:"primary",flat:""},on:{click:function(a){return e.showNewRowDrawer()}}},[e._v("New row")]),t("q-btn",{attrs:{color:"primary",flat:""},on:{click:function(a){return e.showPermissionsDrawer()}}},[e._v("Table Permissions")]),e.selectedRows.length>0?t("q-btn",{attrs:{flat:"",color:"red"},on:{click:e.deleteSelectedRows}},[e._v("Delete selected rows\n      ")]):e._e(),t("q-separator")],1),e._m(0),e.newRowDrawer?e._e():t("q-page-sticky",{attrs:{position:"bottom-right",offset:[20,20]}},[t("q-fab",{attrs:{color:"primary",icon:"keyboard_arrow_up",direction:"up"}},[t("q-fab-action",{attrs:{color:"primary",icon:"fas fa-file-excel"},on:{click:function(a){return e.downloadData("xls")}}}),t("q-fab-action",{attrs:{color:"primary",icon:"fas fa-download"},on:{click:function(a){return e.downloadData("csv")}}})],1)],1)],1),t("q-drawer",{attrs:{side:"right",bordered:"",width:500,breakpoint:500,"content-class":"bg-grey-3"},model:{value:e.newRowDrawer,callback:function(a){e.newRowDrawer=a},expression:"newRowDrawer"}},[t("q-scroll-area",{staticClass:"fit"},[t("div",{staticClass:"q-pa-md"},[t("span",{staticClass:"text-h6"},[e._v("New "+e._s(e.$route.params.tableName))]),t("q-form",{staticClass:"q-gutter-md q-pa-md"},[e._l(e.newRowData,(function(a){return t("div",[["label","measurement","value","email"].indexOf(a.meta.ColumnType)>-1?t("q-input",{attrs:{label:a.meta.ColumnName,filled:""},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"column.value"}}):e._e(),a.meta.ColumnType.startsWith("file.")?t("q-file",{attrs:{filled:"","bottom-slots":"",label:a.meta.ColumnName,counter:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"cloud_upload"},on:{click:function(e){e.stopPropagation()}}})]},proxy:!0},{key:"append",fn:function(){return[t("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){e.stopPropagation(),a.value=null}}})]},proxy:!0}],null,!0),model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"column.value"}}):e._e(),["password"].indexOf(a.meta.ColumnType)>-1?t("q-input",{attrs:{label:a.meta.ColumnName,type:"password",filled:""},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"column.value"}}):e._e(),"truefalse"===a.meta.ColumnType?t("q-toggle",{staticClass:"text-right",attrs:{label:a.meta.ColumnName},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"column.value"}}):e._e(),["content","json"].indexOf(a.meta.ColumnType)>-1?t("span",[e._v(e._s(a.meta.ColumnName))]):e._e(),["content","json"].indexOf(a.meta.ColumnType)>-1?t("q-editor",{attrs:{label:a.meta.ColumnName},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"column.value"}}):e._e(),["datetime"].indexOf(a.meta.ColumnType)>-1?t("q-date",{attrs:{subtitle:a.meta.ColumnName},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"column.value"}}):e._e()],1)})),t("div",[t("q-btn",{staticClass:"float-right",attrs:{label:"Save",color:"primary"},on:{click:e.onNewRow}}),t("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Cancel",color:"primary",flat:""},on:{click:e.onCancelNewRow}})],1)],2)],1)])],1),t("q-drawer",{attrs:{side:"right",bordered:"",width:400,breakpoint:1400,"content-class":"bg-grey-3"},model:{value:e.tablePermissionDrawer,callback:function(a){e.tablePermissionDrawer=a},expression:"tablePermissionDrawer"}},[e.newRowDrawer?e._e():t("q-scroll-area",{staticClass:"fit row"},[t("div",{staticClass:"q-pa-md"},[t("div",{staticClass:"col-12"},[t("span",{staticClass:"text-h5"},[e._v("Table permissions")])])]),t("div",[t("div",{staticClass:"col-12"},[e.tableData?t("table-permissions",{attrs:{selectedTable:e.tableData},on:{close:function(a){e.tablePermissionDrawer=!1}}}):e._e()],1)])])],1)],1)},l=[function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"col-12"},[t("div",{staticStyle:{height:"80vh"},attrs:{id:"spreadsheet"}})])}],n=(t("8e6e"),t("8a81"),t("456d"),t("7f7f"),t("f559"),t("551c"),t("ac6a"),t("cadf"),t("06db"),t("5df3"),t("c47a")),r=t.n(n),s=(t("28a5"),t("2f62")),i=t("1146"),c=t.n(i);function u(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,o)}return t}function d(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?u(Object(t),!0).forEach((function(a){r()(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}window.XLSX=c.a;var m="site.daptin.com"===window.location.hostname?"http://localhost:6336":window.location.protocol+"//"+window.location.hostname+("80"===window.location.port?"":":"+window.location.port),f=t("39ab");f.prototype.extendModule("format","formatters",{image:function(e,a){console.log("format image cell",e);var t=e._cell.column,o=e._cell.row,l=o.data[t.field][0];return console.log("Image data",l),"<img style='width: 300px; height: 200px' class='fileicon' src='data:"+l.type+";base64,"+l.contents+"'/>"},audio:function(e,a){console.log("format audio cell",e);var t=e._cell.column,o=e._cell.row,l=o.data[t.field][0];return"<audio controls class='audio' src='data:"+l.type+";base64,"+l.contents+"'/>"},video:function(e,a){console.log("format video cell",e);var t=e._cell.column,o=e._cell.row,l=o.data[t.field][0];return"<video controls style='width: 300px; height: 200px' class='video' src='data:"+l.type+";base64,"+l.contents+"'/>"},file:function(e,a){console.log("format video cell",e);var t=e._cell.column,o=e._cell.row,l=o.data[t.field][0];return"<a href='"+m+"/asset/"+o.data.__type+"/"+o.data.reference_id+"/"+t.field+".'"+l.type.split("/")[1]+"></a>"}});var p={name:"EditData",methods:d(d({downloadData:function(e){"csv"===e?this.spreadsheet.download("csv",this.$route.params.tableName+".csv"):"xls"===e&&this.spreadsheet.download("xlsx",this.$route.params.tableName+".xls",{sheetName:this.$route.params.tableName})},showPermissionsDrawer:function(){this.newRowDrawer=!1,this.tablePermissionDrawer=!0},showNewRowDrawer:function(){this.tablePermissionDrawer=!1,this.newRowDrawer=!0},deleteSelectedRows:function(){var e=this;0===this.selectedRows.length?this.$q.notify({message:"Select rows to delete"}):Promise.all(this.selectedRows.map((function(a){return e.deleteRow({tableName:e.$route.params.tableName,reference_id:a.reference_id})}))).then((function(){e.spreadsheet.setData()})).catch((function(a){e.$q.notify({message:a[0].title}),e.spreadsheet.setData()}))},onNewRow:function(){var e=this,a={},t=[];e.newRowData.map((function(e){e.meta.ColumnType.startsWith("file.")?(a[e.meta.ColumnName]=[],console.log("Create promise for file",e.value),t.push(function(t){return console.log("File to read",t),new Promise((function(o,l){var n=t.name,r=t.type,s=new FileReader;s.onload=function(t){console.log("File loaded",t),a[e.meta.ColumnName].push({name:n,file:t.target.result,type:r}),o()},s.onerror=function(){console.log("Failed to load file onerror",e,arguments),l(n)},s.readAsDataURL(t)}))}(e.value)),console.log("Asset set set column",e)):a[e.meta.ColumnName]=e.value})),console.log("Promises list",t),a["tableName"]=e.$route.params.tableName,Promise.all(t).then((function(){e.createRow(a).then((function(a){e.$q.notify({message:"Row created"}),e.spreadsheet.setData(),e.newRowData.map((function(e){e.value="",e.meta.ColumnType.startsWith("file.")?e.value=[]:"truefalse"===e.meta.ColumnType?e.value=!1:e.value=""})),e.newRowDrawer=!1})).catch((function(a){a instanceof Array?e.$q.notify({message:a[0].title}):e.$q.notify({message:"Failed to save row"})}))})).catch((function(a){console.log("Failed to upload file",a),e.$q.notify({message:"Failed to upload file: "+a[0]})}))},onCancelNewRow:function(){this.newRowDrawer=!1}},Object(s["b"])(["loadData","getTableSchema","updateRow","createRow","deleteRow"])),{},{refreshData:function(){var e=this,a=[],t=this.$route.params.tableName;console.log("loaded data editor",t),e.getTableSchema(t).then((function(o){e.tableSchema=o,console.log("Schema",e.tableSchema);var l=Object.keys(e.tableSchema.ColumnModel).map((function(t){var o=e.tableSchema.ColumnModel[t];if(o.jsonApi||"__type"===o.ColumnName||e.defaultColumns.indexOf(o.ColumnName)>-1)return null;o.ColumnType.startsWith("file.")?(a.push(o.ColumnName),e.newRowData.push({meta:o,value:[]})):"truefalse"===o.ColumnType?e.newRowData.push({meta:o,value:!1}):e.newRowData.push({meta:o,value:""});var l="truefalse"===o.ColumnType?"tickCross":null,n=200;"content"!==o.ColumnType&&"json"!==o.ColumnType||(l="textarea",n=300);var r={title:o.Name,field:o.ColumnName,editor:!0,headerFilter:!0,editable:!o.ColumnType.startsWith("file."),formatter:l,width:n,hozAlign:"truefalse"===o.ColumnType?"center":"left",sorter:"measurement"===o.ColumnType?"number":null};return o.ColumnType.startsWith("file.")&&o.ColumnType.indexOf("jpg")>-1&&(r.formatter="image"),o.ColumnType.startsWith("file.")&&o.ColumnType.indexOf("mp4")>-1&&(r.formatter="video"),o.ColumnType.startsWith("file.")&&o.ColumnType.indexOf("mp3")>-1&&(r.formatter="audio"),r})).filter((function(e){return!!e}));console.log("Table columns",l),l.unshift({formatter:"rowSelection",titleFormatter:"rowSelection",align:"center",headerSort:!1}),e.spreadsheet=new f("#spreadsheet",{data:[],columns:l,tooltips:!0,ajaxSorting:!0,layout:"fitDataFill",ajaxFiltering:!0,paginationSizeSelector:!0,ajaxProgressiveLoad:"scroll",ajaxProgressiveLoadDelay:200,ajaxProgressiveLoadScrollMargin:600,index:"reference_id",history:!0,movableColumns:!0,rowSelectionChanged:function(a,t){console.log("row selection changed",a,t),e.selectedRows=a},paginationSize:100,cellEdited:function(a){var t=a._cell.row.data.reference_id,o=a._cell.column.field,l=a._cell.value;console.log("cell edited",t,arguments);var n={tableName:e.$route.params.tableName,id:t};n[o]=l,e.updateRow(n).then((function(){e.$q.notify({message:"Saved"})})).catch((function(a){e.$q.notify({message:"Failed to save"}),e.spreadsheet.undo()}))},ajaxURL:e.endpoint+"/api/"+t,ajaxURLGenerator:function(o,l,n){console.log("Generate request url ",o,l,n),l.headers={Authorization:"Bearer "+e.authToken};var r=e.endpoint+"/api/"+t+"?page[number]="+n.page+"&page[size]="+n.size+"&";if(n.sorters){for(var s="",i=0;i<n.sorters.length;i++){var c=n.sorters[i];s=s+("asc"===c.dir?"":"-")+c.field+","}s=s.substring(0,s.length-1),r=r+"sort="+s+"&"}if(n.filters){var u=[];for(var i in n.filters){var d=n.filters[i];switch(d.type){case"like":u.push({column:d.field,operator:"like",value:d.value});break;default:u.push({column:d.field,operator:d.type,value:d.value})}}r=r+"query="+JSON.stringify(u)+"&"}return a.length>0&&(r=r+"included_relations="+a.join(",")+"&"),console.log("Request url ",r),r},rowUpdated:function(e){console.log("Row edited",e)},ajaxResponse:function(e,a,t){return console.log("ajax call complete",e,a,t),{last_page:t.links.last_page,data:t.data.map((function(e){return e.attributes}))}}})})),e.loadData({tableName:"world",params:{query:JSON.stringify([{column:"table_name",operator:"is",value:t}]),included_relations:"user_account"}}).then((function(a){console.log("Table row",a,arguments),a.data&&1===a.data.length?e.tableData=a.data[0]:e.$q.notify({message:"Failed to load table metadata"})})).catch((function(a){console.log("Failed to load table metadata",a),e.$q.notify({message:"Failed to load table metadata"})}))}}),data:function(){return{tablePermissionDrawer:!1,currentPage:1,currentPagination:{},defaultColumns:["updated_at","created_at","reference_id","permission"],tableSchema:{ColumnModel:[]},rows:[],tableData:null,newRowDrawer:!1,newRowData:[],selectedRows:[]}},computed:d({},Object(s["c"])(["endpoint","authToken"])),mounted:function(){this.refreshData()},watch:{}},w=p,b=(t("a4e4"),t("2877")),h=t("ead5"),v=t("0016"),g=t("079e"),y=t("eb85"),C=t("9c40"),_=t("de5e"),D=t("c294"),q=t("72db"),x=t("9404"),R=t("4983"),N=t("0378"),k=t("27f9"),T=t("7d53"),S=t("9564"),O=t("d66b"),j=t("52ee"),P=t("eebe"),$=t.n(P),F=Object(b["a"])(w,o,l,!1,null,"311c71b8",null);a["default"]=F.exports;$()(F,"components",{QBreadcrumbs:h["a"],QIcon:v["a"],QBreadcrumbsEl:g["a"],QSeparator:y["a"],QBtn:C["a"],QPageSticky:_["a"],QFab:D["a"],QFabAction:q["a"],QDrawer:x["a"],QScrollArea:R["a"],QForm:N["a"],QInput:k["a"],QFile:T["a"],QToggle:S["a"],QEditor:O["a"],QDate:j["a"]})},a4e4:function(e,a,t){"use strict";var o=t("23ae"),l=t.n(o);l.a}}]);